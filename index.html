<!DOCTYPE html>
<html lang="english">
<meta charset='UTF-8'>

<head>
    <title>Toronto Waste Lookup</title>
    <link rel='stylesheet' href='css/style.css'>
    <link rel='stylesheet' href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

</html>

<body>
<div id='banner'>Toronto Waste Lookup</div>
<div id='searchBox'>
    <input type='text' id='searchBar' name='searchBar'>
    <div id='searchIcon'>
        <button  type='button' id='search'> <i class="fa fa-search fa-flip-horizontal" aria-hidden="true" style='width: 1em'></i></button>
        
        <script>
        //Create event listener clicking search icon
        document.getElementById('search').addEventListener('click', loadGarbage);
        //create event listener for keydown, call loadGarbage if enterkey is pressed in searchBar
        document.getElementById('searchBar').addEventListener('keydown', function checkKeyPress(x){
            if (x.which === 13){ //not sure if it also needs to check x.keycode?
                loadGarbage();
            }    
        });
        
        function loadGarbage(){
            let searchText = searchBar.value;
            //Create XHR
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://secure.toronto.ca/cc_sr_v1/data/swm_waste_wizard_APR?limit=1000', true);
            
            
            xhr.onload = function(){
                if (this.status == 200){
                    json = JSON.parse(xhr.responseText);
                    var garbList = '';
                    console.log(json.length);
                    for (let i = 0; i < json.length; i++){
                        if (json[i].body.includes(searchText)){
                            garbList += `
                        <div class='list'>
                        <div class='listObj'><i class='fa fa-star'></i>${json[i].title}</div>
                        <div class='listObj'>` + new DOMParser().parseFromString(json[i].body, 'text/html').documentElement.textContent+`</div>
                        </div>
                        `;
                        document.getElementById('garboBin').innerHTML = garbList;
                        }
                    
                    }
                    

                }
            }
                
                
                
            
            xhr.onerror = function(){
                if (this.status == 404){
                    console.log('Connection to database interrupted');
                }
            }
            xhr.send();
            }

        </script>
    </div>


</div>
<div id="garboBin"></div>




</body>